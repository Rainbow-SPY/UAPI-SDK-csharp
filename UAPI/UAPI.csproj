<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props"
            Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')"/>
    <PropertyGroup>
        <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
        <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
        <ProjectGuid>{625E6AF6-B616-49F4-957C-AC5A17F522C7}</ProjectGuid>
        <OutputType>Library</OutputType>
        <AppDesignerFolder>Properties</AppDesignerFolder>
        <RootNamespace>UAPI</RootNamespace>
        <AssemblyName>UAPI-community-sdk-csharp</AssemblyName>
        <TargetFrameworkVersion>v4.7.2</TargetFrameworkVersion>
        <BaseVersion>0.14.1</BaseVersion>
        <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
        <FileAlignment>512</FileAlignment>
        <BaseOutputPath>D:\$Release\UAPI</BaseOutputPath>
    </PropertyGroup>

    <Target Name="GetGitInfo" BeforeTargets="CoreCompile">
        <Exec Command="&quot;C:\Program Files\Git\bin\git.exe&quot; rev-parse --short HEAD"
              StandardOutputImportance="Low"
              ContinueOnError="WarnAndContinue"
              ConsoleToMsBuild="true">
            <Output TaskParameter="ConsoleOutput" PropertyName="GitCommitShortId"/>
        </Exec>

        <!-- 3. æ‹¼æŽ¥æœ€ç»ˆç‰ˆæœ¬ï¼ˆä¿ç•™åŽŸä»£ç ï¼Œä¸å˜ï¼‰ -->
        <PropertyGroup>
            <GitCommitShortId>$([System.String]::Copy('$(GitCommitShortId)').Trim())</GitCommitShortId>
            <GitCommitShortId Condition="'$(GitCommitShortId)' == ''">Unknown</GitCommitShortId>
            <AssemblyInformationalVersion>$(BaseVersion)-$(GitCommitShortId)</AssemblyInformationalVersion>
        </PropertyGroup>

        <!-- 4. æ‰“å°æ—¥å¿—ï¼ˆä¿ç•™åŽŸä»£ç ï¼Œä¸å˜ï¼‰ -->
        <Message Text="ðŸ”§ æå– BaseVersionï¼š$(BaseVersion)" Importance="High"/>
        <Message Text="ðŸ”§ ç”Ÿæˆä¿¡æ¯ç‰ˆæœ¬ï¼š$(AssemblyInformationalVersion)" Importance="High"/>
    </Target>
    
    <!-- 2. åŠ¨æ€ç”ŸæˆGitAssemblyInfo.csï¼ˆä¿ç•™usingã€æ— è¦†ç›–ã€è¯­æ³•æ­£ç¡®ã€ç‰ˆæœ¬æ³¨å…¥æˆåŠŸï¼‰ -->
    <Target Name="WriteAssemblyInfo" AfterTargets="GetGitInfo" BeforeTargets="CoreCompile">
        <PropertyGroup>
            <GitAssemblyInfoPath>$(IntermediateOutputPath)\GitAssemblyInfo.cs</GitAssemblyInfoPath>
            <GitCodeContent>[assembly: System.Reflection.AssemblyInformationalVersion(&quot;$(AssemblyInformationalVersion)&quot;)]</GitCodeContent>
        </PropertyGroup>

        <!-- å†™å…¥æ–‡ä»¶ï¼šç›´æŽ¥ç”¨æ‹¼æŽ¥å¥½çš„çº¯æ–‡æœ¬ï¼Œä¸€æ¬¡æ€§å†™å…¥æ‰€æœ‰è¡Œ -->
        <WriteLinesToFile
                File="$(GitAssemblyInfoPath)"
                Lines="$(GitCodeContent)"
                Overwrite="true"
                Encoding="UTF-8"
                WriteOnlyWhenDifferent="true"/>

        <!-- å°†ä¸´æ—¶æ–‡ä»¶åŠ å…¥ç¼–è¯‘åˆ—è¡¨ï¼Œä¸ŽåŽŸæœ‰AssemblyInfo.csåˆå¹¶ç¼–è¯‘ -->
        <ItemGroup>
            <Compile Include="$(GitAssemblyInfoPath)"/>
        </ItemGroup>
    </Target>
    <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
        <PlatformTarget>AnyCPU</PlatformTarget>
        <DebugSymbols>true</DebugSymbols>
        <DebugType>embedded</DebugType>
        <Optimize>false</Optimize>
        <DefineConstants>DEBUG;TRACE</DefineConstants>
        <ErrorReport>prompt</ErrorReport>
        <WarningLevel>4</WarningLevel>
        <DocumentationFile>..\..\..\%24Release\Rox\Rox.Runtimes.xml</DocumentationFile>
    </PropertyGroup>
    <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
        <PlatformTarget>AnyCPU</PlatformTarget>
        <DebugType>embedded</DebugType>
        <Optimize>true</Optimize>
        <DefineConstants>TRACE</DefineConstants>
        <ErrorReport>prompt</ErrorReport>
        <WarningLevel>4</WarningLevel>
        <DocumentationFile>..\..\..\%24Release\Rox\Rox.Runtimes.xml</DocumentationFile>
    </PropertyGroup>
    <ItemGroup>
        <Reference Include="mscorlib"/>
        <Reference Include="Newtonsoft.Json">
            <HintPath>..\..\..\$Release\Rox\Newtonsoft.Json.dll</HintPath>
        </Reference>
        <Reference Include="Rox.Runtimes">
            <HintPath>..\..\..\$Release\Rox\Rox.Runtimes.dll</HintPath>
        </Reference>
        <Reference Include="Rox.Text">
            <HintPath>..\..\..\$Release\Rox\Rox.Text.dll</HintPath>
        </Reference>
        <Reference Include="System"/>
        <Reference Include="System.ComponentModel.Composition"/>
        <Reference Include="System.Core"/>
        <Reference Include="System.Data"/>
        <Reference Include="System.Numerics"/>
        <Reference Include="System.Windows.Forms"/>
        <Reference Include="System.Xml"/>
    </ItemGroup>
    <ItemGroup>
        <Compile Include="bilibili.GetArchives.Type.cs" />
        <Compile Include="bilibili.GetArchives.cs"/>
        <Compile Include="bilibili.GetUserData.cs"/>
        <Compile Include="bilibili.GetVideoData.cs" />
        <Compile Include="bilibili.GetLiveRoomStatus.Type.cs" />
        <Compile Include="bilibili.GetLiveRoomStatus.cs"/>
        <Compile Include="bilibili.GetUserData.Type.cs" />
        <Compile Include="bilibili.GetVideoData.Type.cs" />
        <Compile Include="EpicGames.GetFreeGames.cs"/>
        <Compile Include="EpicGames.GetFreeGames.Type.cs" />
        <Compile Include="github.GetReposData.cs"/>
        <Compile Include="github.GetReposData.Type.cs" />
        <Compile Include="hotboard.bilibili.cs" />
        <Compile Include="hotboard.bilibili.Type.cs" />
        <Compile Include="hotboard.NeteaseMusic.cs" />
        <Compile Include="hotboard.NeteaseMusic.Type.cs" />
        <Compile Include="IException\IException.EpicGames.cs"/>
        <Compile Include="IException\IException.Hotboard.cs" />
        <Compile Include="IException\IException.minecraft.cs"/>
        <Compile Include="IException\IException.Steam.cs"/>
        <Compile Include="IException\IException.Weather.cs"/>
        <Compile Include="IException\IException.bilibili.cs"/>
        <Compile Include="IException\IException.General.cs"/>
        <Compile Include="IException\IException.github.cs"/>
        <Compile Include="IException\IException.QQ.cs"/>
        <Compile Include="Interface.APIHealthStatus.cs"/>
        <Compile Include="Interface.common.cs"/>
        <Compile Include="Interface.Convert.cs" />
        <Compile Include="Interface.APIHealthStatus.Type.cs" />
        <Compile Include="Interface.HotBoard.cs" />
        <Compile Include="Interface.HotBoard.Type.cs" />
        <Compile Include="Interface.Type.cs" />
        <Compile Include="minecraft.GetHistoryName.cs"/>
        <Compile Include="minecraft.GetServerStatus.cs"/>
        <Compile Include="minecraft.GetUserData.cs"/>
        <Compile Include="minecraft.GetHistoryName.Type.cs" />
        <Compile Include="minecraft.GetServerStatus.Type.cs" />
        <Compile Include="minecraft.GetUserData.Type.cs" />
        <Compile Include="network.GetMyIP.cs" />
        <Compile Include="network.GetMyIP.Type.cs" />
        <Compile Include="Properties\AssemblyInfo.cs"/>
        <Compile Include="QQ.GetGroupData.cs"/>
        <Compile Include="QQ.GetUserData.cs"/>
        <Compile Include="QQ.GetGroupData.Type.cs" />
        <Compile Include="QQ.GetUserData.Type.cs" />
        <Compile Include="Steam.SteamID.Converter.cs"/>
        <Compile Include="Steam.SteamID.cs"/>
        <Compile Include="Steam.SteamID.SteamIDType.cs"/>
        <Compile Include="Steam.GetUserData.cs"/>
        <Compile Include="Steam.GetUserData.Type.cs" />
        <Compile Include="Weather.GetWeather.cs"/>
        <Compile Include="Weather.GetWeather.Type.cs" />
    </ItemGroup>
    <ItemGroup>
        <PackageReference Include="Microsoft.Win32.Primitives" Version="4.3.0"/>
        <PackageReference Include="System.Buffers" Version="4.6.1"/>
        <PackageReference Include="System.Diagnostics.DiagnosticSource" Version="10.0.2"/>
        <PackageReference Include="System.IO" Version="4.3.0"/>
        <PackageReference Include="System.Memory" Version="4.6.3"/>
        <PackageReference Include="System.Net.Http" Version="4.3.4"/>
        <PackageReference Include="System.Numerics.Vectors" Version="4.6.1"/>
        <PackageReference Include="System.Runtime" Version="4.3.1"/>
        <PackageReference Include="System.Runtime.CompilerServices.Unsafe" Version="6.1.2"/>
        <PackageReference Include="System.Security.Cryptography.Algorithms" Version="4.3.1"/>
        <PackageReference Include="System.Security.Cryptography.Encoding" Version="4.3.0"/>
        <PackageReference Include="System.Security.Cryptography.Primitives" Version="4.3.0"/>
        <PackageReference Include="System.Security.Cryptography.X509Certificates" Version="4.3.2"/>
    </ItemGroup>
    <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets"/>
</Project>
